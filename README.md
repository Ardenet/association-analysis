## 关联分析模型

运用的关联分析方法有：基于规则的关联分析方法、基于统计的关联分析、基于数据挖掘的关联分析

### 1. 日志格式：

  (1)用来组织日志的字段(顶层字段)：pid, ppid, ip, time（顶层字段是所有日志都必须填充的字段）。

  (2)其他系统额外添加的信息字段(补充字段)：嵌套填充，每个结构必须是字典形式，比如file是panda能填充的字段，里面又可以嵌套字典形式的字段。

  (3)所有顶层字段最终汇总成一个pattern.json文件格式，提供给每个系统来填充，可能浪费空间，但目前比较方便进行关联分析，之后再进行优化。

### 2.关联规则：

  (1)每个字段的含义需要描述清楚。

  (2)每个字段需要标明是希望用来组织日志的顶层字段，还是额外补充信息的补充字段。

  (3)每个字段关联关系，字段之间的关联关系如下：

```
(a)互斥字段，比如os，若两条日志的操作系统不一致，则两条日志完全无关

(b)直接相等字段，比如pid，再满足互斥字段相等的情况下，若两条日志的pid一致，则两个日志是有关联关系的

(c)更复杂的关联关系，两条日志的某几个字段在满足某种情况下，是存在关联关系的，如两条日志的ppid和pid交叉相等
```

  提交形式，一个json格式文件，一个描述的表格CSV格式

  表格内容：

| 字段 | 字段类型 | 值类型           | 默认值(字符类型) | 字段全部可选选项     | 字段含义     | 字段关联关系 |
| ---- | -------- | ---------------- | ---------------- | -------------------- | ------------ | ------------ |
| os   | 顶层     | string(字典dict) | ""(字典NULL)     | {windows7,ubuntu...} | 操作系统类型 | a            |



### 3.日志文件格式：

  (1)日志文件名:可选字符串+uuid4(或系统时间) +".json"，比如panda_00b8ff3f-fcf4-4c6a-a625-12b77d6a31ef.json

  (2)日志文件形式:最外层是一个列表，列表的每一项是一条日志，每条日志都是嵌套的字典形式，即使只有一条日志最外层也用列表包裹。

  (3)日志顶层字段的问题：每条日志都包含了顶层字段，如果很多条日志的顶层字段都是一样的就浪费了空间，可以自己定义格式和解析方法，添加到代码里面。
​     示例如下：

```json
        [
            {
                "os": "window",
                "analyzer": "",
                "time": 23345678909876655,
                "pid": 5888,
                "ppid": "",
                "file": {
                    "file_handle": "",
                    "write": {
                        "buf": "",
                        "buf_len": ""
                    }
                },
                "other": {}
            },
            {
                "os": "ubuntu",
                "analyzer": "",
                "time": 23323456789098766388,
                "pid": 5993,
                "ppid": "",
                "file": {
                    "file_handle": "",
                    "write": {
                        "buf": "",
                        "buf_len": ""
                    }
                },
                "other": {}
            }
        ]
```

### 4.关于时间字段

  若系统镜像内部时间是对情况下，可以通过实际创建进程的时间，加上当前时刻进程已经运行时间来估算time

  时间统一格式，从UTC1970-1-1 0:0:0开始计时到当前时间的秒数。